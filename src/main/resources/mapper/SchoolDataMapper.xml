<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ninewatt.ems.schoolData.mapper.SchoolDataMapper">

    <select id="selectTotalBillPerClass" resultType="Map">
SELECT
       D.site_name AS "category",
       ROUND(C.total_bill/A.class_cnt) AS "value"
FROM ems.ismart_bas A
INNER JOIN ems.total_info D ON A.ismart_no = D.cust_no
LEFT JOIN ems.cyber_kepco_info B
    ON A.ismart_no = B.cust_no
LEFT JOIN ems.cyber_kepco_cost C
    ON A.ismart_no = C.cust_no
    AND C.sel_cost = B.sel_cost
WHERE B.end_month = #{tgtDate}
  AND B.end_month = C.end_month
<choose>
    <when test="ismartList==null || ismartList.isEmpty()">
        AND A.ismart_no = null
    </when>
    <otherwise>
        AND A.ismart_no in
        <foreach item="item" open="(" separator="," close=")" collection="ismartList">
            #{item.ismartId}
        </foreach>
    </otherwise>
</choose>
ORDER BY 2 desc
    </select>

</mapper>
